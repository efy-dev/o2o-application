<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta charset="UTF-8">
    <title>收货地址</title>
    <link rel="stylesheet" href="guide/css/layouts.css">
</head>
<body>
<div class="header" dot-template="header"></div>
<!--//End--header-->

<article class="address">
    <div class="address-list" style="display: block;">
        <div dot-template="address-list">
            <div class="item">
                <p><strong>温群英</strong><span>15110008479</span></p>
                <p>北京市朝阳区酒仙桥东路9号电子城科技园A2西侧6层</p>
                <i class="arrow-right"></i>
            </div>
            <div class="item">
                <p><strong>温群英</strong><span>15110008479</span></p>
                <p>北京市朝阳区酒仙桥东路9号电子城科技园A2西侧6层</p>
                <i class="arrow-right"></i>
            </div>
        </div>
        <input class="btn-new" type="button" value="新增收货地址"/>
    </div>
    <!--/End/地址列表-->
    <div class="address-add" style="display: none;">
        <form action="">
            <div class="group">
                <strong>收货人：</strong>
                <label for=""><input type="text" placeholder="请输入收货人" id="consignee"/></label>
            </div>
            <div class="group">
                <strong>手机号：</strong>
                <label for=""><input type="text" placeholder="手机号" id="phone"/></label>
            </div>
            <div class="group">
                <strong>所在地区：</strong>
                <label class="select" for="">
                    <select name="" id="0" dot-template="province-list">
                        <!--<option value="110000">北京</option>-->
                    </select>
                </label>
            </div>
            <div class="group">
                <strong>&nbsp;</strong>
                <label class="select" for="">
                    <select name="" id="1" dot-template="city-list">
                        <!--<option value="110000">朝阳区</option>-->
                    </select>
                </label>
            </div>
            <div class="group">
                <strong>&nbsp;</strong>
                <label class="select" for="">
                    <select name="" id="2" dot-template="district-list">
                        <!--<option value="110000">酒仙桥</option>-->
                    </select>
                </label>
            </div>
            <div class="group text">
                <strong>具体地址：</strong>
                <label for="">
                    <textarea name="details" id="doc-vld-ta-2-1" class="text-act" required=""></textarea>
                </label>
            </div>
            <div class="group button">
                <input type="button" value="保存收货人信息" id="save_address" fun-type="add"/>
            </div>
        </form>
    </div>
    <!--/End/新增地址-->

</article>

<script type="text/x-dot-template" id="address-list">
    {{ for(var i = 0 ; i < it.length ; i++){ }}
        <div class="item">
            <p><strong class="data-item consignee">{{=it[i].consignee}}</strong><span class="data-item phone">{{=it[i].phone}}</span></p>
            <!--<p class="display-none data-item id">{{=it[i].id}}</p>
            {{ if(it[i].province!=null){ }}
                <p class="display-none data-item province-id">{{=it[i].province.id}}</p>
            {{ } }}
            {{ if(it[i].city!=null){ }}
                <p class="display-none data-item city-id">{{=it[i].city.id}}</p>
            {{ } }}
            {{ if(it[i].district!=null){ }}
                <p class="display-none data-item district-id">{{=it[i].district.id}}</p>
            {{ } }}-->
            <p class="data-item details">{{=it[i].details}}</p>
            <i class="arrow-right"></i>
        </div>
    {{ } }}
</script>

<script type="text/x-dot-template" id="province-list">
    {{ for(var i = 0 ; i < it.length ; i++){ }}
        <option value="{{=it[i].id}}">{{=it[i].name}}</option>
    {{ } }}
</script>

<script type="text/x-dot-template" id="city-list">
    {{ for(var i = 0 ; i < it.length ; i++){ }}
        <option value="{{=it[i].id}}">{{=it[i].name}}</option>
    {{ } }}
</script>

<script type="text/x-dot-template" id="district-list">
    {{ for(var i = 0 ; i < it.length ; i++){ }}
        <option value="{{=it[i].id}}">{{=it[i].name}}</option>
    {{ } }}
</script>


<script src="common/js/common.js"></script>
<script src="common/js/util.js"></script>
<script src="common/js/weixin.js"></script>
<script src="guide/js/controller.js"></script>
<script src="guide/js/model.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<!--//End-->


<script>
    $().ready(function () {
        initPage();
    });
    function initPage() {
        $("[dot-template=header]").html(renderHeader(PageVariable));
        $('h1').html('地址列表');
        addressEvent();

        getAddressList(function () {
            renderTemplate(PageVariable.template.addressList, PageVariable.addressList);

            $(".arrow-right").on("click", function () {
                $(".address .address-list").hide();
                $(".address .address-add").show();
                $("#save_address").attr("fun-type", "update");
                $('h1').html('修改收货地址');

                /*var data_items = $(this).parent().find(".data-item");
                for(var i = 0; i < data_items.length; i++) {

                }*/
            });
        });

        getProvinceList(function () {
            renderTemplate(PageVariable.template.provinceList, PageVariable.provinceList);
            $("#0").on("change", function () {
                var param = {};
                param.provinceId = $(this).val();
                PageVariable.param = param;
                buildCityList();
                $("#2").children().remove();
            });
        });

        $("#save_address").on("click", function () {
            var param = {};
            param.consignee = $("#consignee").val();
            param.phone = $("#phone").val();
            param.details = $("#doc-vld-ta-2-1").val();

            var provinceId = $("#0").val();
            var cityId = $("#1").val();
            var districtId = $("#2").val();

            if(provinceId != null && provinceId != "") {
                param.provinceId = provinceId;
            }

            if(cityId != null && cityId != "") {
                param.cityId = cityId;
            }

            if(districtId != null && districtId != "") {
                param.districtId = districtId;
            }

            ajaxRequest(PageVariable.service.addAddress, param, function (data) {
                if(data.code == "0") {
                    location.reload();
                }
            });
        });
    }

    function buildCityList() {
        getCityList(PageVariable.param, function () {
            renderTemplate(PageVariable.template.cityList, PageVariable.cityList);
            $("#1").on("change", function () {
                var param = {};
                param.cityId = $(this).val();
                PageVariable.param = param;
                buildDistrictList();
            });
        });
    }

    function buildDistrictList() {
        getDistrictList(PageVariable.param, function () {
            renderTemplate(PageVariable.template.districtList, PageVariable.districtList);
        });
    }

    function addressEvent() {
        var $address = $('article.address');
        var $list = $address.find('div.address-list'); //地址列表
        var $add = $address.find('div.address-add');   //新建收货人表单
        var $selectAddress = $address.find('div.item');   //新增收货人信息按钮
        var $newAddress = $address.find('input.btn-new');   //新增收货人信息按钮

        //新增收货地址
        $newAddress.on('click', function () {
            $list.hide();
            $add.show();
            $("#save_address").attr("fun-type", "add");
            $('h1').html('新增收货地址');
        });
    }



</script>


</body>
</html>